{
  "info": {
    "name": "Telesales Admin - Sales Management",
    "description": "Complete API testing for Admin Sales Management features",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "telesales-001"
  },
  "item": [
    {
      "name": "Authentication",
      "item": [
        {
          "name": "1. Login Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test status code",
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// Test response structure",
                  "pm.test('Response has correct structure', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('success');",
                  "    pm.expect(jsonData).to.have.property('data');",
                  "    pm.expect(jsonData).to.have.property('message');",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "// Test tokens in response",
                  "pm.test('Response contains tokens', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('tokens');",
                  "    pm.expect(jsonData.data.tokens).to.have.property('accessToken');",
                  "    pm.expect(jsonData.data.tokens).to.have.property('refreshToken');",
                  "});",
                  "",
                  "// Test user info in response",
                  "pm.test('Response contains user info', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('user');",
                  "    pm.expect(jsonData.data.user).to.have.property('id');",
                  "    pm.expect(jsonData.data.user).to.have.property('role');",
                  "    pm.expect(jsonData.data.user.role).to.equal('admin');",
                  "});",
                  "",
                  "// Save tokens to environment",
                  "if (pm.response.code === 200) {",
                  "    const responseData = pm.response.json();",
                  "    pm.environment.set('accessToken', responseData.data.tokens.accessToken);",
                  "    pm.environment.set('refreshToken', responseData.data.tokens.refreshToken);",
                  "    pm.environment.set('adminId', responseData.data.user.id);",
                  "    pm.environment.set('userRole', responseData.data.user.role);",
                  "    ",
                  "    console.log('âœ… Login successful');",
                  "    console.log('ðŸ‘¤ User ID:', responseData.data.user.id);",
                  "    console.log('ðŸ”‘ Access Token:', responseData.data.tokens.accessToken.substring(0, 30) + '...');",
                  "    console.log('ðŸ”„ Refresh Token:', responseData.data.tokens.refreshToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{adminEmail}}\",\n  \"password\": \"{{adminPassword}}\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/login",
              "host": ["{{apiUrl}}"],
              "path": ["login"]
            },
            "description": "Login as admin user to get access and refresh tokens"
          },
          "response": []
        },
        {
          "name": "2. Login with Invalid Credentials",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Returns error message', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.false;",
                  "    pm.expect(jsonData.message).to.include('Invalid');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"wrong@example.com\",\n  \"password\": \"WrongPassword123!\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/login",
              "host": ["{{apiUrl}}"],
              "path": ["login"]
            },
            "description": "Test login with wrong credentials - should return 401"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Sales Management - CRUD",
      "item": [
        {
          "name": "3. Create Sales Account",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Sales created successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('idSales');",
                  "    pm.expect(jsonData.data).to.have.property('nama');",
                  "    pm.expect(jsonData.data).to.have.property('email');",
                  "    pm.expect(jsonData.data).not.to.have.property('passwordHash');",
                  "});",
                  "",
                  "pm.test('Sales is active by default', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.isActive).to.be.true;",
                  "});",
                  "",
                  "// Save sales ID",
                  "if (pm.response.code === 201) {",
                  "    const responseData = pm.response.json();",
                  "    pm.environment.set('salesId', responseData.data.idSales);",
                  "    console.log('âœ… Sales created:', responseData.data.idSales);",
                  "}"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Generate unique email",
                  "const timestamp = Date.now();",
                  "pm.environment.set('testEmail', `sales.test.${timestamp}@example.com`);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nama\": \"John Doe Test\",\n  \"email\": \"{{testEmail}}\",\n  \"password\": \"SalesPass123!\",\n  \"nomorTelepon\": \"081234567890\",\n  \"domisili\": \"Jakarta\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/admin/sales",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales"]
            },
            "description": "Create new sales account - requires admin authentication"
          },
          "response": []
        },
        {
          "name": "4. Create Sales Without Auth (Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Unauthorized access blocked', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nama\": \"Unauthorized Sales\",\n  \"email\": \"unauth@example.com\",\n  \"password\": \"Pass123!\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/admin/sales",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales"]
            },
            "description": "Attempt to create sales without authentication - should fail with 401"
          },
          "response": []
        },
        {
          "name": "5. Create Sales with Invalid Data (Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 422', function () {",
                  "    pm.response.to.have.status(422);",
                  "});",
                  "",
                  "pm.test('Validation errors returned', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nama\": \"Invalid Sales\",\n  \"email\": \"invalid-email\",\n  \"password\": \"123\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/admin/sales",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales"]
            },
            "description": "Create sales with invalid data - should fail with 422"
          },
          "response": []
        },
        {
          "name": "6. Get All Sales",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Returns sales array', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('sales');",
                  "    pm.expect(jsonData.data.sales).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('Returns pagination info', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('pagination');",
                  "    pm.expect(jsonData.data.pagination).to.have.property('total');",
                  "    pm.expect(jsonData.data.pagination).to.have.property('page');",
                  "    pm.expect(jsonData.data.pagination).to.have.property('limit');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{apiUrl}}/admin/sales?page=1&limit=10",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            },
            "description": "Get all sales accounts with pagination"
          },
          "response": []
        },
        {
          "name": "7. Get All Sales - Filter Active",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('All sales are active', function () {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.data.sales.length > 0) {",
                  "        jsonData.data.sales.forEach(sales => {",
                  "            pm.expect(sales.isActive).to.be.true;",
                  "        });",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{apiUrl}}/admin/sales?isActive=true",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales"],
              "query": [
                {
                  "key": "isActive",
                  "value": "true"
                }
              ]
            },
            "description": "Get only active sales accounts"
          },
          "response": []
        },
        {
          "name": "8. Get All Sales - Search",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{apiUrl}}/admin/sales?search=john",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales"],
              "query": [
                {
                  "key": "search",
                  "value": "john"
                }
              ]
            },
            "description": "Search sales by name or email"
          },
          "response": []
        },
        {
          "name": "9. Get Sales By ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Returns correct sales', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.idSales).to.equal(pm.environment.get('salesId'));",
                  "});",
                  "",
                  "pm.test('Password hash not exposed', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).not.to.have.property('passwordHash');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{apiUrl}}/admin/sales/{{salesId}}",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales", "{{salesId}}"]
            },
            "description": "Get specific sales account by ID"
          },
          "response": []
        },
        {
          "name": "10. Get Sales By Invalid ID (Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{apiUrl}}/admin/sales/00000000-0000-0000-0000-000000000000",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales", "00000000-0000-0000-0000-000000000000"]
            },
            "description": "Attempt to get non-existent sales - should return 404"
          },
          "response": []
        },
        {
          "name": "11. Update Sales Account",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Sales updated successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.nama).to.equal('John Doe Updated');",
                  "    pm.expect(jsonData.data.domisili).to.equal('Bandung');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nama\": \"John Doe Updated\",\n  \"domisili\": \"Bandung\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/admin/sales/{{salesId}}",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales", "{{salesId}}"]
            },
            "description": "Update sales account information"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Sales Management - Password & Status",
      "item": [
        {
          "name": "12. Reset Sales Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Password reset successful', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data.message).to.include('successfully');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"newPassword\": \"NewStrongPass123!\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/admin/sales/{{salesId}}/reset-password",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales", "{{salesId}}", "reset-password"]
            },
            "description": "Reset password for sales account"
          },
          "response": []
        },
        {
          "name": "13. Reset Password with Weak Password (Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 422', function () {",
                  "    pm.response.to.have.status(422);",
                  "});",
                  "",
                  "pm.test('Weak password rejected', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"newPassword\": \"123\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/admin/sales/{{salesId}}/reset-password",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales", "{{salesId}}", "reset-password"]
            },
            "description": "Attempt to reset with weak password - should fail"
          },
          "response": []
        },
        {
          "name": "14. Deactivate Sales Account",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Sales deactivated successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.message).to.include('deactivated');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{apiUrl}}/admin/sales/{{salesId}}/deactivate",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales", "{{salesId}}", "deactivate"]
            },
            "description": "Deactivate sales account"
          },
          "response": []
        },
        {
          "name": "15. Deactivate Already Deactivated (Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{apiUrl}}/admin/sales/{{salesId}}/deactivate",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales", "{{salesId}}", "deactivate"]
            },
            "description": "Attempt to deactivate already deactivated account - should fail"
          },
          "response": []
        },
        {
          "name": "16. Activate Sales Account",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Sales activated successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.message).to.include('activated');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{apiUrl}}/admin/sales/{{salesId}}/activate",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales", "{{salesId}}", "activate"]
            },
            "description": "Activate sales account"
          },
          "response": []
        },
        {
          "name": "17. Delete Sales Account",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Sales deleted successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.message).to.include('deleted');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{apiUrl}}/admin/sales/{{salesId}}",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales", "{{salesId}}"]
            },
            "description": "Soft delete sales account"
          },
          "response": []
        },
        {
          "name": "18. Delete Already Deleted (Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{apiUrl}}/admin/sales/{{salesId}}",
              "host": ["{{apiUrl}}"],
              "path": ["admin", "sales", "{{salesId}}"]
            },
            "description": "Attempt to delete already deleted account - should fail"
          },
          "response": []
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    }
  ]
}
